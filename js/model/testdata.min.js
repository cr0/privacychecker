var TestData=Backbone.Model.extend({USE_PICTURES:!0,USE_POSTS:!1,MAX_INIT_ITEMS:12,TEST_ROUNDS:20,INITIAL_SCORE:1e3,TEST_DATA_SIZE:5,initialize:function(e){this.player=FacebookPlayer.getInstance();this.set("pictures",undefined);this.set("posts",undefined);this.set("data",undefined);this.USE_PICTURES&&this._collectPictures();this.rateTupples={};this.allreadyComparedTuples=[];this.ratePtr=0;this.elo=new EloRating;this.remainingRates=this.TEST_ROUNDS},getRateTupple:function(){var e=this.get("pictures");if(--this.remainingRates<0){console.debug("[TestData] Rating done: ",this.rateTupples);this._extractTestData();return undefined}this.ratePtr=this.ratePtr%e.length;var t=e.at(this.ratePtr++),n=null,r=!0;while(r||t===n){n=e.at($.randomBetween(0,e.length));if(n===undefined)continue;r=_.contains(this.allreadyComparedTuples,t.id+n.id)}this.allreadyComparedTuples.push(t.id+n.id);console.debug("[TestData] Pair is ",t," and ",n);return[t,n]},setWinner:function(e,t,n){var r=this.rateTupples[e.id]!==undefined?this.rateTupples[e.id]:this.INITIAL_SCORE,i=this.rateTupples[t.id]!==undefined?this.rateTupples[t.id]:this.INITIAL_SCORE;this.elo.setNewSetings(r,i,e===n?1:0,t===n?1:0);var s=this.elo.getNewRatings();this.rateTupples[e.id]=s.a;this.rateTupples[t.id]=s.b;console.log("[TestData] New scores: ",s.a,s.b)},getMaxRounds:function(){return this.TEST_ROUNDS},getCurrentRound:function(){return this.TEST_ROUNDS-this.remainingRates},_collectPictures:function(){console.log("[TestData] Collecting pictures for test");var e=this.player.getPictures(),t=new FacebookPictureCollection,n=e.length<this.MAX_INIT_ITEMS?e.length:this.MAX_INIT_ITEMS;console.debug("[TestData] availablePics "+e.length+" to pick "+n);while(n-->0){var r=e.at($.randomBetween(0,e.length-1));r!==undefined&&r.get("privacy").get("level")!==PrivacyDefinition.Level.NOBODY&&!t.contains(r)?t.add(r):++n}this.set("pictures",t);console.info("[TestData] Using the following "+this.MAX_INIT_ITEMS+" pictures for test:",this.get("pictures"))},_extractTestData:function(){var e=this.TEST_DATA_SIZE,t=[];while(--e>=0){var n=null;_.each(_.keys(this.rateTupples),_.bind(function(e){if(n===null||n<=this.rateTupples[e])n=e},this));delete this.rateTupples[n];t.push(this.get("pictures").get(n))}this.set("data",t);console.log("[TestData] The following data is select to test: ",t)}},{getInstance:function(){this.__instance===undefined&&(this.__instance=new this);return this.__instance}});