var FacebookRandomCollector=Backbone.Model.extend({collect:function(e){e===undefined&&(e={});var t=e.min!==undefined?e.min:FacebookRandomCollector.DEFAULT_MIN,n=e.users!==undefined?e.users:new FacebookUserCollection;console.warn("[FacebookRandomCollector] Starting to collect, taking groups");this._collectGroup({users:n,min:t,done:_.bind(function(e){this.trigger("frc:done",e)},this),more:_.bind(function(e){console.warn("[FacebookRandomCollector] Need more users, taking events");this._collectEvents({users:e,min:t,done:_.bind(function(e){this.trigger("frc:done",e)},this),more:_.bind(function(e){console.warn("[FacebookRandomCollector] Need more users, taking search");this._collectSearch({users:e,min:t,done:_.bind(function(e){this.trigger("frc:done",e)},this),more:_.bind(function(e){console.error("[FacebookRandomCollector] Need more users, nothing to take");this.trigger("frc:less",e)},this)})},this)})},this)})},_collectGroup:function(e){var t=FacebookPlayer.getInstance();FB.api(FacebookRandomCollector.FB_GROUP_URL,_.bind(function(n){if(!n.data){this.trigger("frc:error");console.error("[FacebookRandomCollector] Error loading groups, response was: ",n);throw new Error({message:"[FacebookRandomCollector] Error loading groups, response was: "+n})}_.each(n.data,function(n){n.members.data&&n.members.data.length>0&&_.each(n.members.data,function(n){t.id!==n.id&&t.getFriends().get(n.id)===undefined&&e.users.add({name:n.name,id:n.id,type:FacebookUser.Type.FOREIGNER})})});console.debug("[FacebookRandomCollector] Having now "+e.users.length+" users with groups: ",e.users);e.users.length<e.min?e.more(e.users):e.done(e.users)},this))},_collectEvents:function(e){var t=FacebookPlayer.getInstance();FB.api(FacebookRandomCollector.FB_EVENT_URL,_.bind(function(n){if(!n.data){this.trigger("frc:error");console.error("[FacebookRandomCollector] Error loading groups, response was: ",n);throw new Error({message:"[FacebookRandomCollector] Error loading groups, response was: "+n})}_.each(n.data,function(n){n.attending&&n.attending.data&&n.attending.data.length>0&&_.each(n.attending.data,function(n){t.getFriends().get(n.id)===undefined&&e.users.add({name:n.name,id:n.id,type:FacebookUser.Type.FOREIGNER})});e.users.length<e.min&&n.maybe&&n.maybe.data&&n.maybe.data.length>0&&_.each(n.maybe.data,function(n){t.getFriends().get(n.id)===undefined&&e.users.add({name:n.name,id:n.id,type:FacebookUser.Type.FOREIGNER})});e.users.length<e.min&&n.invited&&n.invited.data&&n.invited.data.length>0&&_.each(n.invited.data,function(n){t.getFriends().get(n.id)===undefined&&e.users.add({name:n.name,id:n.id,type:FacebookUser.Type.FOREIGNER})});e.users.length<e.min&&n.declined&&n.declined.data&&n.declined.data.length>0&&_.each(n.declined.data,function(n){t.getFriends().get(n.id)===undefined&&e.users.add({name:n.name,id:n.id,type:FacebookUser.Type.FOREIGNER})})});console.debug("[FacebookRandomCollector] Having now "+e.users.length+" users with events: ",e.users);e.users.length<e.min?e.more(e.users):e.done(e.users)},this))},_collectSearch:function(e){var t=FacebookPlayer.getInstance();this.alreadySearched=this.alreadySearched===undefined?[]:this.alreadySearched;var n=undefined;while(!n||_.contains(this.alreadySearched,n))n=FacebookRandomCollector.USER_TO_SEARCH[$.randomBetween(0,FacebookRandomCollector.USER_TO_SEARCH.length-1)];this.alreadySearched.push(n);var r=FacebookRandomCollector.FB_SEARCH_URL+n;FB.api(r,_.bind(function(r){if(!r.data){this.trigger("frc:error");console.error("[FacebookRandomCollector] Error loading search, response was: ",r);throw new Error({message:"[FacebookRandomCollector] Error loading search, response was: "+r})}_.each(r.data,function(n){t.id!==n.id&&t.getFriends().get(n.id)===undefined&&e.users.add({name:n.name,id:n.id,type:FacebookUser.Type.FOREIGNER})});console.debug("[FacebookRandomCollector] Having now "+e.users.length+" users with search for "+n+":",e.users);e.users.length<e.min?this._collectSearch(e):e.done(e.users)},this))}},{FB_GROUP_URL:"/me/groups/?fields=members.limit(50).fields(id,name)&limit=3",FB_EVENT_URL:"/me/events?fields=attending.limit(10).fields(id,name),maybe.limit(10).fields(id,name),invited.limit(10).fields(id,name),declined.limit(10).fields(id,name)&limit=3",FB_FRIEND_FEED_URL:"/?fields=feed.limit(100).fields(likes.fields(id,name),comments.fields(from))",FB_SEARCH_URL:"/search?type=user&limit=10&q=",USER_TO_SEARCH:["hans","michael","christian","fritz","max","simon","paul","nina","anna","nicole","claudia","lisa","miriam","franz","sophie","stefan","hannes","malte","klaus","yvonne","kathrin","katharina","rainer","mark","dieter","horst","josef","magda","sarah"],DEFAULT_MIN:200,getInstance:function(){this.__instance===undefined&&(this.__instance=new this);return this.__instance}});